<template>
    <article id="blog" class="flex flex-col max-w-3xl w-full mx-auto mt-8">
        <a
            href="/blog"
            class="inline-flex items-center gap-2 text-base !text-gray-500 dark:!text-gray-400 !no-underline hover:!text-pink-500 focus:!text-pink-500 mb-2 mr-auto"
        >
            <span>←</span>
            Blog
        </a>
        <h1 class="!text-3xl !md:text-4xl font-medium">
            {{ props.title }}
        </h1>
        <aside class="flex gap-2 items-center mt-3">
            <img
                class="w-9 h-9 rounded-full"
                :src="profile"
                :alt="props.author"
            />
            <div class="flex flex-col justify-start">
                <h3 class="!text-sm !m-0 opacity-75">{{ props.author }}</h3>
                <p
                    class="flex flex-row items-center gap-2 !text-xs !m-0 opacity-75"
                >
                    <time :datetime="props.date">{{ props.date }}</time>
                    <span>ー</span>
                    <a :href="twitter" target="_blank">@{{ author.twitter }}</a>
                </p>
            </div>
        </aside>
        <img
            :src="props.src"
            :alt="props.alt"
            class="w-full mt-5 mb-2"
            :class="props.shadow ? 'shadow-xl shadow-black/7.5' : 'border'"
        />
        <main id="blog-content">
            <slot />
        </main>

        <a
            href="/"
            class="inline-flex items-center gap-2 text-base !text-gray-500 dark:!text-gray-400 !no-underline hover:!text-pink-500 focus:!text-pink-500 mt-2 mr-auto"
        >
            <span>←</span>
            Elysia: Ergonomic Framework for Humans
        </a>
    </article>
    <Teleport v-if="loaded" defer to="#VPContent">
   		<Banner class="-translate-y-12 md:-translate-y-18" />
    </Teleport>
</template>

<script lang="ts" setup>
import { onMounted, onUnmounted, ref } from 'vue'

const loaded = ref(false)

onMounted(() => {
	loaded.value = true
})

import Banner from '../fern/banner.vue'

const authors = {
    saltyaom: {
        src: 'lilith-happy.webp',
        twitter: 'saltyaom'
    }
}

type Authors = typeof authors

const props = defineProps<{
    title: string
    src: string
    alt: string
    author: keyof Authors
    date: string
    shadow?: boolean
}>()

const author = authors[props.author]
const profile = `/blog/authors/${author.src}`
const twitter = `https://twitter.com/${author.twitter}`

const mutated = ['.aside', '.content', '.content-container', '.VPDocFooter']
onMounted(() => {
    mutated.forEach((selector) => {
        document.querySelector(selector)?.classList.add('blog')
    })
})

onUnmounted(() => {
    mutated.forEach((selector) => {
        document.querySelector(selector)?.classList.remove('blog')
    })
})
</script>

<style>
@reference "../../tailwind.css";

.blog.aside {
    position: fixed !important;
    z-index: 10;
    left: calc(50% + 48rem / 2 + 2rem) !important;
}

.blog.content,
.blog.content-container {
    max-width: unset !important;
}

.blog.VPDocFooter {
    display: none !important;
}

#blog {
    @apply text-lg mt-0;
}

#blog > img {
    @apply rounded-2xl;
}

#blog > h1 {
    @apply !text-3xl md:!text-4xl font-semibold;
}

#blog > h2 {
    @apply !text-2xl md:!text-3xl font-semibold;
}

#blog > h3 {
    @apply !text-xl md:!text-2xl font-semibold;
}

#blog-content > video,
#blog-content > * > video,
#blog-content > img,
#blog-content > * > img {
    @apply rounded-xl my-4;
    /* box-shadow: 0 8px 25px rgba(0,0,0,.1) */
}

.-png {
    box-shadow: unset !important;
    background: transparent !important;
}

@media (min-width: 768px) {
    #blog > h1 {
        line-height: 3.25rem !important;
    }
}
</style>
